# TP1_Reseau

## I. Gather informations

* Récupérer une **liste des cartes réseau** avec leur nom, leur IP et leur adresse MAC : 

    * La commande `ip a` nous permet de visualiser les différentes cartes réseaux avec leur IP, leur nom et leur MAC.

* Déterminer si les cartes réseaux ont récupéré une **IP en DHCP** ou non :  
    * En utilisant la commande `ip a`, on peut voir à côté du nom de la carte que le DHCP n'est pas activé.

* Afficher la **table de routage** de la machine et sa **table ARP** :

   * Afficher la table ARP  
        * On utilise la commande `ip neigh show`. On peut désormais voir les adresses MAC qui correspondent aux adresses IP.  
            ```
            10.0.2.2 dev enp0s3 lladdr 52:54:00:12:35:02 STALE
            192.168.56.100 dev enp0s8 lladdr 08:00:27:42:0a:ba STALE
            192.168.56.1 dev enp0s8 lladdr 0a:00:27:00:00:00 REACHABLE 
            ```     
        * Par exemple, l'adresse ip `192.168.56.100` correspond à la MAC `08:00:27:42:0a:ba`

* Récupérer la **liste des ports en écoute** :  
    * `ss -tu` pour afficher la liste 
        ```
            Netid                     State                      Recv-Q                       Send-Q                                               Local Address:Port                                             Peer Address:Port
            tcp                       ESTAB                      0                            0                                                   192.168.56.101:ssh                                              192.168.56.1:53055
        ```
    * On peut voir que le serveur ssh écoute sur le port 53055.

* Récupérer la liste des **DNS** utilisés par la machine :
    ```
    [root@alex sysconfig]#  cat /etc/resolv.conf
    # Generated by NetworkManager
    search auvence.co
    nameserver 10.33.10.20
    nameserver 10.33.10.2
    nameserver 8.8.8.8
    ```


* Afficher l'état actuel du **firewall** :
    ```
    [root@alex sysconfig]# firewall-cmd --state
    running
    ```  
    * Les interfaces filtrées :  
        ```
        [root@alex sysconfig]# firewall-cmd --get-active-zone
        public
            interfaces: enp0s3 enp0s8
        ```  

## II. Edit configuration

### 1/ Configuration Cartes Réseaux
* Modifier la configuration de la carte réseau privée :  
    * On créer un nouveau fichier dans le dossier `/etc/sysconfig/network-scripts/` et on créer le fichier `ifcfg-enp0s8`.    
    * Dedans on va y mettre toutes les infos suivants :    
   ```
    TYPE="Ethernet"
    BOOTPROTO="static"
    NAME="enp0s8"
    DEVICE="enp0s8"
    ONBOOT="yes"
    IPADDR=192.168.56.19
    NETMASK=255.255.255.0
   ```
   * Refresh de NetworkManager avec `sudo nmcli c reload` et on restart l'interface `sudo nmcli con up enp0s8`

   * On vérifie que l'adresse a bien été modifiée avec un `ip a` :    
   ```
    3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:6d:27:c7 brd ff:ff:ff:ff:ff:ff
    inet 192.168.56.19/24 brd 192.168.56.255 scope global noprefixroute enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe6d:27c7/64 scope link
       valid_lft forever preferred_lft forever
   ```  
   * L'IP a bien été modifiée.

   ### 2/ Serveur SSH
* Modifier la configuration du système pour que le serveur SSH tourne sur le port 2222 
    * On se rend directement dans le fichier sshd_config qui se trouve à l'emplacement suivant : `/etc/ssh/`.
    * On remplace la ligne `#port22` par `port2222`.
    * Ensuite on ajoute le port 2222 au pare-feu : `firewall-cmd --zone=public --add-port=2222/tcp --permanent`.
    * Puis on ferme le port 22 : `firewall-cmd --zone=public --remove-port=22/tcp`.
    * Pour vérifier que le port a bien été modifié on peut utiliser la commande `ss -lntp` :  
        ```
        [alex@alex ~]$ ss -lntp
        State                          Recv-Q                           Send-Q                                                      Local Address:Port                                                     Peer Address:Port
        LISTEN                         0                                128                                                               0.0.0.0:2222                                                          0.0.0.0:*
        LISTEN                         0                                128                                                                  [::]:2222                                                             [::]:*

        ```

## III. Routage simple

* Création de ma première VM `client1.tp1` qui est dans le réseau `net1 : 192.168.57.0/24` et qui a **l'addresse ip** `192.168.57.1`.

* Création de ma deuxième VM `client2.tp1` qui est dans le réseau `net2 : 192.168.56.0/24` et qui a **l'addresse ip** `192.168.56.1`.

* Création du routeur qui sera dans le réseau `net1` et `net2` qui a les addresses suivantes :  
    * `192.168.57.254` pour le réseau `net1` 
    * `192.168.56.254` pour le réseau `net2`

* J'ai ensuite changé le nom des hostnames pour mes VMs :
    ```
        [alex@routeur ~]$
        [alex@client2 ~]$
        [alex@client1 ~]$
    ```

* Enfin j'ai associé les Ips des VMs à leur nom dans le fichier `/etc/host` :   
    *  Fichier hosts du routeur

    ```
        [alex@routeur ~]$ cat /etc/hosts
        127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
        ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
        192.168.57.50 client1.tp1
        192.168.56.50 client2.tp2

    ```

    *  Fichier hosts du client2

    ```
    [alex@client2 ~]$ cat /etc/hosts
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
    192.168.56.254 routeur.tp1
    192.168.57.50 client1.tp1

    ```

    *  Fichier hosts du client1

    ```
    [alex@client1 ~]$ cat /etc/hosts
    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
    192.168.56.50 client2.tp1
    192.168.56.254 routeur.tp1

    ```
* Maintenant on peut ping la machine client1 vers le client2 :
    ```
    [alex@client1 ~]$ ping client2.tp1
    PING client2.tp1 (192.168.56.50) 56(84) bytes of data.
    64 bytes from client2.tp1 (192.168.56.50): icmp_seq=1 ttl=63 time=0.536 ms
    64 bytes from client2.tp1 (192.168.56.50): icmp_seq=2 ttl=63 time=1.23 ms
    ^C
    --- client2.tp1 ping statistics ---
    2 packets transmitted, 2 received, 0% packet loss, time 6ms
    rtt min/avg/max/mdev = 0.536/0.883/1.231/0.348 ms
    ```

    * Si il y a un ping il y a un pong donc pour le routing on est bon étant donné que les machines sont dans deux réseaux différents, elles doivent donc passer par le routeur qui fait la liaison entre les deux réseaux.

## IV. Autres applications et métrologie

### 1/ Commandes

* jouer avec `iftop`  
    * iftop est une "application" qui permet d'observer le trafic réseau sur l'interface demandé. J'avoue ne pas trop avoir pris le temps de regarder comment on s'en servait.

### 2/ Cockpit



### 3/ Netdata






 


    

    




